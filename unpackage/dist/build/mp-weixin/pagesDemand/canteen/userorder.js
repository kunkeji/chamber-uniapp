(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesDemand/canteen/userorder"],{"0168":function(e,t,r){"use strict";(function(e,t){var s=r("47a9");r("13b0");s(r("3240"));var i=s(r("6a2a"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(i.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},"06ec":function(e,t,r){"use strict";r.r(t);var s=r("dc70"),i=r.n(s);for(var n in s)["default"].indexOf(n)<0&&function(e){r.d(t,e,(function(){return s[e]}))}(n);t["default"]=i.a},"6a2a":function(e,t,r){"use strict";r.r(t);var s=r("cb54"),i=r("06ec");for(var n in i)["default"].indexOf(n)<0&&function(e){r.d(t,e,(function(){return i[e]}))}(n);r("8296");var d=r("828b"),a=Object(d["a"])(i["default"],s["b"],s["c"],!1,null,"b2ec9468",null,!1,s["a"],void 0);t["default"]=a.exports},7081:function(e,t,r){},8296:function(e,t,r){"use strict";var s=r("7081"),i=r.n(s);i.a},cb54:function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){}));var s=function(){var e=this,t=e.$createElement,r=(e._self._c,e.cart.length),s=r>0?e.__map(e.cart,(function(t,r){var s=e.__get_orig(t),i=(t.price*t.quantity).toFixed(2);return{$orig:s,g1:i}})):null;e.$mp.data=Object.assign({},{$root:{g0:r,l0:s}})},i=[]},dc70:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={data:function(){return{navigationBarTitle:"下单页面",selectedOrderType:"",expectedTime:this.getDefaultTime(),deliveryFee:0,isAddressPopupVisible:!1,deliveryAddress:{name:"",gender:"0",phone:"",address:""},cart:[],orderTypes:[{value:"1",label:"到店吃",icon:"🍽️"},{value:"2",label:"到店取",icon:"🥡"},{value:"3",label:"外卖",icon:"🛵"}],genderOptions:[{value:"0",label:"男"},{value:"1",label:"女"},{value:"2",label:"超人"}],lastOrderType:"",errors:{name:"",phone:"",address:""}}},computed:{totalPrice:function(){return this.cart.reduce((function(e,t){return e+t.price*t.quantity}),0)},totalOrderPrice:function(){return this.totalPrice+("3"===this.selectedOrderType?this.deliveryFee:0)}},methods:{selectOrderType:function(e){this.selectedOrderType=e,this.saveOrderType(e),"1"!==e&&"2"!==e||(this.expectedTime=this.getDefaultTime()),"3"===e&&(this.getLocalAddress()||this.showAddressPopup())},onTimeChange:function(e){this.expectedTime=e.detail.value},onGenderChange:function(e){this.deliveryAddress.gender=e.detail.value},showAddressPopup:function(){this.isAddressPopupVisible=!0},closeAddressPopup:function(){this.isAddressPopupVisible=!1},saveAddress:function(){this.deliveryAddress.name&&this.deliveryAddress.phone&&this.deliveryAddress.address?(e.setStorageSync("deliveryAddress",this.deliveryAddress),this.isAddressPopupVisible=!1,e.showToast({title:"地址保存成功",icon:"success"})):e.showToast({title:"请填写完整信息",icon:"none"})},getLocalAddress:function(){var t=e.getStorageSync("deliveryAddress");return!!t&&(this.deliveryAddress=t,!0)},saveOrderType:function(t){e.setStorageSync("lastOrderType",t)},getLastOrderType:function(){return e.getStorageSync("lastOrderType")},submitOrder:function(){if(""!==this.selectedOrderType)if("dine-in"!==this.selectedOrderType&&"takeaway"!==this.selectedOrderType||"请选择时间"!==this.expectedTime)if("delivery"!==this.selectedOrderType||this.deliveryAddress.name&&this.deliveryAddress.phone&&this.deliveryAddress.address){var t=toString(this.deliveryAddress),r="";switch(this.deliveryAddress["gender"]){case"0":r="先生";break;case"1":r="女士";break;case"2":r="超人";break}t=this.deliveryAddress["name"]+r+" "+this.deliveryAddress["phone"]+" "+this.deliveryAddress["address"];var s={shop_id:this.shop_id,goods:JSON.stringify(this.cart),address:t,expected_time:this.expectedTime,total_amount:this.totalOrderPrice,remark:"",order_type:this.selectedOrderType};this.$util.request("main.Shop.createOrder",s).then((function(t){200===t.code?e.requestPayment({provider:"wxpay",timeStamp:t.data.timeStamp,nonceStr:t.data.nonceStr,package:t.data.package,paySign:t.data.paySign,signType:"MD5",success:function(t){"requestPayment:ok"==t.errMsg&&e.navigateTo({url:"/pagesDemand/canteen/canteenDetails"}),console.log("success",t)},fail:function(t){console.log("fail",t),e.showToast({title:"支付失败",icon:"none",duration:2e3})}}):e.showToast({title:"订单生成失败",icon:"none",duration:2e3})})),e.showToast({icon:"success",title:"订单提交成功",duration:2e3})}else e.showToast({icon:"none",title:"请填写完整的外卖地址",duration:2e3});else e.showToast({icon:"none",title:"请选择预计用餐时间",duration:2e3});else e.showToast({icon:"none",title:"请选择订单类型",duration:2e3})},getDefaultTime:function(){var e=new Date;e.setMinutes(e.getMinutes()+20);var t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0");return"".concat(t,":").concat(r)},validateName:function(){return this.deliveryAddress.name.trim()?(this.errors.name="",!0):(this.errors.name="请输入姓名",!1)},validatePhone:function(){return this.deliveryAddress.phone?/^1[3-9]\d{9}$/.test(this.deliveryAddress.phone)?(this.errors.phone="",!0):(this.errors.phone="请输入正确的手机号码",!1):(this.errors.phone="请输入手机号码",!1)},validateAddress:function(){return this.deliveryAddress.address.trim()?(this.errors.address="",!0):(this.errors.address="请输入详细地址",!1)},validateForm:function(){var e=this.validateName(),t=this.validatePhone(),r=this.validateAddress();return e&&t&&r}},onLoad:function(e){e.cart&&(this.cart=JSON.parse(decodeURIComponent(e.cart))),this.shop_id=e.shopid,this.lastOrderType=this.getLastOrderType(),this.lastOrderType&&this.selectOrderType(this.lastOrderType)}};t.default=r}).call(this,r("df3c")["default"])}},[["0168","common/runtime","common/vendor"]]]);