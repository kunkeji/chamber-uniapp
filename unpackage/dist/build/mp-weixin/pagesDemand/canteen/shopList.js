(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesDemand/canteen/shopList"],{"02c4":function(e,t,r){"use strict";r.r(t);var n=r("a4e4"),s=r.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=s.a},"492e":function(e,t,r){"use strict";(function(e,t){var n=r("47a9");r("13b0");n(r("3240"));var s=n(r("a2ca"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(s.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},6068:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s})),r.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,r=(e._self._c,e.__map(["1","2","3","4","5"],(function(t,r){var n=e.__get_orig(t),s=e.getStatusText(t);return{$orig:n,m0:s}}))),n=e.hasOrders?e.__map(e.filteredOrders,(function(t,r){var n=e.__get_orig(t),s=e.getOrderTypeText(t.order_type);return{$orig:n,m1:s}})):null;e._isMounted||(e.e0=function(t,r){var n=arguments[arguments.length-1].currentTarget.dataset,s=n.eventParams||n["event-params"];r=s.status;return e.changeStatus(r)}),e.$mp.data=Object.assign({},{$root:{l0:r,l1:n}})},s=[]},a2ca:function(e,t,r){"use strict";r.r(t);var n=r("6068"),s=r("02c4");for(var a in s)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return s[e]}))}(a);r("e934");var o=r("828b"),i=Object(o["a"])(s["default"],n["b"],n["c"],!1,null,"4627cdf5",null,!1,n["a"],void 0);t["default"]=i.exports},a4e4:function(e,t,r){"use strict";(function(e){var n=r("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(r("7eb4")),a=n(r("7ca3")),o=n(r("ee10"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={data:function(){return{navigationBarTitle:"商家管理",shops:[],selectedShop:{},showDropdown:!1,isBusinessOpen:!0,currentStatus:"1",orders:[],processingOrders:new Set,isLoading:!1}},computed:{filteredOrders:function(){var e=this;return this.orders.filter((function(t){return t.status===e.currentStatus}))},hasOrders:function(){return this.filteredOrders.length>0}},watch:{selectedShop:{handler:function(e){e.id&&this.fetchOrders()},immediate:!0}},methods:{getOrderTypeText:function(e){return{1:"到店吃",2:"到店取",3:"外卖"}[e]||"未知类型"},toggleDropdown:function(){this.showDropdown=!this.showDropdown},selectShop:function(e){this.selectedShop=e,this.showDropdown=!1,this.fetchOrders()},toggleBusinessStatus:function(t){this.isBusinessOpen=t.detail.value,this.$util.request("main.Shop.updateStatusByShopId",{shop_id:this.selectedShop["id"]}).then((function(t){1===t.code&&e.showToast({title:"状态已更新",duration:2e3})}))},changeStatus:function(e){this.currentStatus=e,this.fetchOrders()},fetchShops:function(){var t=this;return(0,o.default)(s.default.mark((function r(){var n;return s.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$util.request("main.Shop.getShopByUserId");case 3:if(n=r.sent,1!==n.code){r.next=10;break}return t.shops=n.data,t.selectedShop=t.shops[0],t.isBusinessOpen="1"===t.selectedShop["status"],r.next=10,t.fetchOrders();case 10:r.next=16;break;case 12:r.prev=12,r.t0=r["catch"](0),console.error("获取店铺列表失败:",r.t0),e.showToast({title:"获取店铺失败",icon:"error",duration:2e3});case 16:case"end":return r.stop()}}),r,null,[[0,12]])})))()},fetchOrders:function(){var t=this;return(0,o.default)(s.default.mark((function r(){var n,a;return s.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,n={shop_id:t.selectedShop.id,type:"all",page:1,limit:10},r.next=4,t.$util.request("main.Shop.getOrderListByShopIdPage",n);case 4:a=r.sent,1===a.code&&(t.orders=a.data.map((function(e){return c(c({},e),{},{isProcessing:!1})}))),r.next=12;break;case 8:r.prev=8,r.t0=r["catch"](0),console.error("获取订单列表失败:",r.t0),e.showToast({title:"获取订单失败",icon:"error",duration:2e3});case 12:case"end":return r.stop()}}),r,null,[[0,8]])})))()},handleOrderAction:function(t,r){var n=this;return(0,o.default)(s.default.mark((function a(){var o,i,c,u;return s.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!n.processingOrders.has(t)){s.next=2;break}return s.abrupt("return");case 2:return n.processingOrders.add(t),o=n.orders.find((function(e){return e.order_number===t})),o&&n.$set(o,"isProcessing",!0),s.prev=5,i={order_number:t,status:r},s.next=9,n.$util.request("main.Shop.changeStatus",i);case 9:if(c=s.sent,1!==c.code){s.next=16;break}return e.showToast({title:"操作成功",icon:"success",duration:2e3}),s.next=14,n.fetchOrders();case 14:s.next=17;break;case 16:e.showToast({title:"操作失败",icon:"error",duration:2e3});case 17:s.next=23;break;case 19:s.prev=19,s.t0=s["catch"](5),console.error("操作失败:",s.t0),e.showToast({title:"操作失败",icon:"error",duration:2e3});case 23:return s.prev=23,n.processingOrders.delete(t),u=n.orders.find((function(e){return e.order_number===t})),u&&n.$set(u,"isProcessing",!1),s.finish(23);case 28:case"end":return s.stop()}}),a,null,[[5,19,23,28]])})))()},navigateTo:function(t){var r=this.selectedShop["id"];switch(t){case"menu1":e.navigateTo({url:"/pagesDemand/shopDetails/goodsDetails?id="+r});break;case"menu2":e.navigateTo({url:"/pagesDemand/shopDetails/shopDetails?id="+r});break;case"menu3":e.navigateTo({url:"/pagesDemand/shopDetails/completeOrder"});break;default:break}},getStatusText:function(e){return{1:"已支付",2:"已接单",3:"已准备",4:"配送中",5:"已完成"}[e]||e}},onShow:function(){this.fetchShops()}};t.default=u}).call(this,r("df3c")["default"])},e934:function(e,t,r){"use strict";var n=r("fa6d"),s=r.n(n);s.a},fa6d:function(e,t,r){}},[["492e","common/runtime","common/vendor"]]]);