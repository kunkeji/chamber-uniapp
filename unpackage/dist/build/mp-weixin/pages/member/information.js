(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/information"],{"30fe":function(e,t,a){},"31dd":function(e,t,a){"use strict";a.r(t);var n=a("d7b9"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},"34ca":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){}));var n=function(){var e=this.$createElement;this._self._c},i=[]},7872:function(e,t,a){"use strict";(function(e,t){var n=a("47a9");a("13b0");n(a("3240"));var i=n(a("efee"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(i.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},"918c":function(e,t,a){"use strict";var n=a("30fe"),i=a.n(n);i.a},d7b9:function(e,t,a){"use strict";(function(e){var n=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(a("3b2d")),o=n(a("af34")),l=n(a("7ca3")),u=a("8f59");function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var d={components:{memberApply:function(){Promise.all([a.e("common/vendor"),a.e("pages/component/member/apply")]).then(function(){return resolve(a("3c69"))}.bind(null,a)).catch(a.oe)}},data:function(){return{loadEnd:!1,titleBarHeight:0,memberType:1,selectScreen:1,personInfo:{},companyInfo:{},organizeInfo:{},uploadedList:[],backTimer:null}},computed:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){(0,l.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},(0,u.mapState)({themeColor:function(e){return e.app.themeColor}})),mounted:function(){var t=e.getSystemInfoSync().statusBarHeight,a=e.getMenuButtonBoundingClientRect();this.titleBarHeight=t+2*(a.top-t)+a.height},onLoad:function(){var t=this;e.showLoading({title:"加载中"}),this.getMemberState((function(){t.loadEnd=!0,e.hideLoading()}))},onUnload:function(){clearTimeout(this.backTimer)},methods:{pageChange:function(e){this.pageShow=e},getMemberState:function(t){var a=this;this.$util.request("member.state").then((function(n){1==n.code?(a.memberState=n.data.state,6==a.memberState.state?a.getMemberInfo(t):-1==a.memberState.state?(e.hideLoading(),e.showModal({title:"系统提示",content:"您还没有入会，请入会后操作",cancelText:"返回",confirmText:"去申请",success:function(t){t.confirm?a.$util.toPage({mode:2,path:"/pages/member/apply/index"}):1==getCurrentPages().length?e.switchTab({url:"/pages/mine/index"}):e.navigateBack()}})):7==a.memberState.state?(e.hideLoading(),e.showModal({title:"系统提示",content:"您的会员已过期，请缴纳会费后操作",cancelText:"返回",confirmText:"去缴纳",success:function(t){t.confirm?a.$util.toPage({mode:2,path:"/pages/member/fees/index"}):1==getCurrentPages().length?e.switchTab({url:"/pages/mine/index"}):e.navigateBack()}})):(e.hideLoading(),e.showModal({title:"系统提示",content:"您已提交入会申请，请通过后操作",cancelText:"返回",confirmText:"前往查看",success:function(t){t.confirm?e.switchTab({url:"/pages/mine/index"}):1==getCurrentPages().length?e.switchTab({url:"/pages/index/index"}):e.navigateBack()}}))):e.showToast({title:n.msg,icon:"none"})})).catch((function(e){console.error("获取会员状态 ",e)}))},getMemberInfo:function(t){var a=this;this.$util.request("member.information").then((function(n){t&&t(),1==n.code?(a.uploadedList=[],n.data.company?(a.memberType=2,a.companyInfo={person:a.setMemberField(n.data.person,1),company:a.setMemberField(n.data.company,2)}):n.data.organize?(a.memberType=3,a.organizeInfo={person:a.setMemberField(n.data.person,1),organize:a.setMemberField(n.data.organize,3)}):(a.memberType=1,a.personInfo=a.setMemberField(n.data,1)),t&&t()):e.showToast({title:n.msg,icon:"none"})})).catch((function(e){console.error("获取会员信息 ",e)}))},setMemberField:function(e,t){var a=this,n=JSON.parse(JSON.stringify(e));return 1==t?n.forEach((function(e){"checkbox"==e.type?e.value?e.value=e.value.split(","):e.value=[]:"text"==e.type&&"address"==e.field?e.value||(e.value={latitude:"",longitude:"",name:"",address:""}):"image"==e.type?"avatar"==e.field?e.value?a.uploadedList.push(e.value):e.value="":e.value?("string"==typeof e.value&&(e.value=e.value.split(",")),a.uploadedList=[].concat((0,o.default)(a.uploadedList),(0,o.default)(e.value))):e.value=[]:"cert"==e.type?e.value?e.value.image&&a.uploadedList.push(e.value.image):e.value={name:"",number:"",image:""}:"video"==e.type&&a.uploadedList.push(e.value),"name"!=e.field&&"mobile"!=e.field&&"member_level_id"!=e.field||(e.disabled=!0)})):n.forEach((function(e){"checkbox"==e.type?e.value?e.value=e.value.split(","):e.value=[]:"image"==e.type?2==a.memberType&&"company_logo"==e.field||3==a.memberType&&"organize_logo"==e.field?e.value?a.uploadedList.push(e.value):e.value="":e.value?("string"==typeof e.value&&(e.value=e.value.split(",")),a.uploadedList=[].concat((0,o.default)(a.uploadedList),(0,o.default)(e.value))):e.value=[]:"cert"==e.type?e.value?e.value.image&&a.uploadedList.push(e.value.image):e.value={name:"",number:"",image:""}:"video"==e.type&&a.uploadedList.push(e.value)})),n},changeScreen:function(t){this.selectScreen!=t&&(e.pageScrollTo({scrollTop:0,duration:0}),this.selectScreen=t)},heandleSubmit:function(){var t=this;e.showLoading({title:"加载中",mask:!0}),this.$refs.memberPerson.getApplyField((function(a){var n=[];for(var i in a){if(1==a[i].required){var o=!1;if("text"==a[i].type&&"address"==a[i].field?a[i].value.address||(o=!0):"checkbox"==a[i].type?a[i].value.length||(o=!0):"image"==a[i].type?"avatar"==a[i].field?a[i].value||(o=!0):a[i].value.length||(o=!0):"cert"==a[i].type?a[i].value.name&&a[i].value.number&&a[i].value.image||(o=!0):a[i].value||(o=!0),o)return e.hideLoading(),void e.showToast({icon:"none",title:a[i].label+"不能为空"})}if("number"==a[i].type&&"mobile"==a[i].field&&!t.$util.validation("phone",a[i].value))return e.hideLoading(),void e.showToast({icon:"none",title:"请输入正确的手机号"});if("cert"==a[i].type&&(a[i].value.name||a[i].value.number||a[i].value.image)&&(!a[i].value.name||!a[i].value.number||!a[i].value.image))return e.hideLoading(),void e.showToast({icon:"none",title:a[i].label+"存在未填项"});if("number"==a[i].type)a[i].value=Number(a[i].value);else if("checkbox"==a[i].type)a[i].value=a[i].value.join();else if("image"==a[i].type){if("avatar"==a[i].field)t.uploadedList.includes(a[i].value)||n.push({type:1,index:i,value:a[i].value});else if(a[i].value.length)for(var l in a[i].value)t.uploadedList.includes(a[i].value[l])||n.push({type:1,index:i,number:l,value:a[i].value[l]})}else"video"==a[i].type&&a[i].value?t.uploadedList.includes(a[i].value)||n.push({type:1,index:i,value:a[i].value}):"cert"==a[i].type&&a[i].value.image&&(t.uploadedList.includes(a[i].value.image)||n.push({type:1,index:i,value:a[i].value.image}))}1==t.memberType?n.length?t.uploadFiles(n,(function(e){for(var i in n)"image"==a[n[i].index].type?"avatar"==a[n[i].index].field?a[n[i].index].value=e[i]:a[n[i].index].value[n[i].number]=e[i]:"video"==a[n[i].index].type?a[n[i].index].value=e[i]:"cert"==a[n[i].index].type&&(a[n[i].index].value.image=e[i]);t.submitEvent(a)})):t.submitEvent(a):t.$refs.memberEnterprise.getApplyField((function(i){for(var o in i){if(1==i[o].required){var l=!1;if("checkbox"==i[o].type?i[o].value.length||(l=!0):"image"==i[o].type?2==t.memberType&&"company_logo"==i[o].field||3==t.memberType&&"organize_logo"==i[o].field?i[o].value||(l=!0):i[o].value.length||(l=!0):"cert"==i[o].type?i[o].value.name&&i[o].value.number&&i[o].value.image||(l=!0):i[o].value||(l=!0),l)return e.hideLoading(),void e.showToast({icon:"none",title:i[o].label+"不能为空"})}if("cert"==i[o].type&&(i[o].value.name||i[o].value.number||i[o].value.image)&&(!i[o].value.name||!i[o].value.number||!i[o].value.image))return e.hideLoading(),void e.showToast({icon:"none",title:i[o].label+"存在未填项"});if("number"==i[o].type)i[o].value=Number(i[o].value);else if("checkbox"==i[o].type)i[o].value=i[o].value.join();else if("image"==i[o].type){if(2==t.memberType&&"company_logo"==i[o].field||3==t.memberType&&"organize_logo"==i[o].field)t.uploadedList.includes(i[o].value)||n.push({type:2,index:o,value:i[o].value});else if(i[o].value.length)for(var u in i[o].value)t.uploadedList.includes(i[o].value[u])||n.push({type:2,index:o,number:u,value:i[o].value[u]})}else"video"==i[o].type&&i[o].value?t.uploadedList.includes(i[o].value)||n.push({type:2,index:o,value:i[o].value}):"cert"==i[o].type&&i[o].value.image&&(t.uploadedList.includes(i[o].value.image)||n.push({type:2,index:o,value:i[o].value.image}))}n.length?t.uploadFiles(n,(function(e){for(var o in n)1==n[o].type?"image"==a[n[o].index].type?"avatar"==a[n[o].index].field?a[n[o].index].value=e[o]:a[n[o].index].value[n[o].number]=e[o]:"video"==a[n[o].index].type?a[n[o].index].value=e[o]:"cert"==a[n[o].index].type&&(a[n[o].index].value.image=e[o]):"image"==i[n[o].index].type?2==t.memberType&&"company_logo"==i[n[o].index].field||3==t.memberType&&"organize_logo"==i[n[o].index].field?i[n[o].index].value=e[o]:i[n[o].index].value[n[o].number]=e[o]:"video"==i[n[o].index].type?i[n[o].index].value=e[o]:"cert"==i[n[o].index].type&&(i[n[o].index].value.image=e[o]);2==t.memberType?t.submitEvent({person:a,company:i}):3==t.memberType&&t.submitEvent({person:a,organize:i})})):2==t.memberType?t.submitEvent({person:a,company:i}):3==t.memberType&&t.submitEvent({person:a,organize:i})}))}))},uploadFiles:function(e,t){this.$util.uploadFileMultiple(e.map((function(e){return e.value}))).then((function(e){t(e)})).catch((function(e){console.error("上传文件 ",e)}))},submitEvent:function(t){var a=this;if(1==this.memberType)for(var n in t)"image"==t[n].type&&"object"==(0,i.default)(t[n].value)&&(t[n].value=t[n].value.join());else if(2==this.memberType){for(var o in t.person)"image"==t.person[o].type&&"object"==(0,i.default)(t.person[o].value)&&(t.person[o].value=t.person[o].value.join());for(var l in t.company)"image"==t.company[l].type&&"object"==(0,i.default)(t.company[l].value)&&(t.company[l].value=t.company[l].value.join())}else if(3==this.memberType){for(var u in t.person)"image"==t.person[u].type&&"object"==(0,i.default)(t.person[u].value)&&(t.person[u].value=t.person[u].value.join());for(var r in t.organize)"image"==t.organize[r].type&&"object"==(0,i.default)(t.organize[r].value)&&(t.organize[r].value=t.organize[r].value.join())}this.$util.request("member.editInformation",{type:this.memberType,data:JSON.stringify(t)}).then((function(t){1==t.code?(e.showToast({mask:!0,title:"保存成功",duration:1500}),clearTimeout(a.backTimer),a.backTimer=setTimeout((function(){e.navigateBack()}),1500)):e.showToast({title:t.msg,icon:"none"})})).catch((function(t){e.hideLoading(),console.error("编辑资料 ",t)}))}}};t.default=d}).call(this,a("df3c")["default"])},efee:function(e,t,a){"use strict";a.r(t);var n=a("34ca"),i=a("31dd");for(var o in i)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(o);a("918c");var l=a("828b"),u=Object(l["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=u.exports}},[["7872","common/runtime","common/vendor"]]]);