(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/apply/enterprise"],{"283d":function(e,t,i){"use strict";i.r(t);var n=i("71db"),a=i("815d");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("f83b");var l=i("828b"),u=Object(l["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=u.exports},"71db":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){}));var n=function(){var e=this.$createElement;this._self._c},a=[]},"815d":function(e,t,i){"use strict";i.r(t);var n=i("e9f5"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"897e":function(e,t,i){},d06b:function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("13b0");n(i("3240"));var a=n(i("283d"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},e9f5:function(e,t,i){"use strict";(function(e){var n=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(i("3b2d")),o=n(i("af34")),l=n(i("7ca3")),u=n(i("db5e")),r=i("8f59");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}var c={components:{memberApply:function(){Promise.all([i.e("common/vendor"),i.e("pages/component/member/apply")]).then(function(){return resolve(i("3c69"))}.bind(null,i)).catch(i.oe)}},data:function(){return{pageShow:!1,loadEnd:!1,titleBarHeight:0,applyField:[],memberType:null,isReapply:!1,uploadedList:[]}},computed:function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){(0,l.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},(0,r.mapState)({themeColor:function(e){return e.app.themeColor},iconSheet:function(e){return u.default.svgToUrl("sheet",e.app.themeColor)},subscribeIds:function(e){return e.app.subscribeNotifyIds}})),mounted:function(){var t=e.getSystemInfoSync().statusBarHeight,i=e.getMenuButtonBoundingClientRect();this.titleBarHeight=t+2*(i.top-t)+i.height},onLoad:function(t){var i=this;this.isReapply=1==t.reapply,e.showLoading({title:"加载中"}),this.memberType=t.type,this.isReapply?this.getMemberInfo((function(){i.loadEnd=!0,e.hideLoading()})):this.getField((function(){i.loadEnd=!0,e.hideLoading()}))},methods:{pageChange:function(e){this.pageShow=e},getField:function(t){var i=this;this.$util.request("member.field",{type:this.memberType}).then((function(n){if(t&&t(),1==n.code){var a=[];a=2==i.memberType?n.data.company:n.data.organize,a.forEach((function(e){"checkbox"==e.type?e.value=[]:"image"==e.type?2==i.memberType&&"company_logo"==e.field||3==i.memberType&&"organize_logo"==e.field?e.value="":e.value=[]:"cert"==e.type?e.value={name:"",number:"",image:""}:"file"==e.type?e.value=[]:e.value=""})),i.applyField=a}else e.showToast({title:n.msg,icon:"none"})})).catch((function(e){console.error("获取入会字段 ",e)}))},getMemberInfo:function(t){var i=this;this.$util.request("member.applyDetails").then((function(n){if(1==n.code){var a=[];a=2==i.memberType?n.data.company:n.data.organize,i.uploadedList=[],a.forEach((function(e){"checkbox"==e.type?e.value?e.value=e.value.split(","):e.value=[]:"image"==e.type?2==i.memberType&&"company_logo"==e.field||3==i.memberType&&"organize_logo"==e.field?e.value?i.uploadedList.push(e.value):e.value="":e.value?("string"==typeof e.value&&(e.value=e.value.split(",")),i.uploadedList=[].concat((0,o.default)(i.uploadedList),(0,o.default)(e.value))):e.value=[]:"cert"==e.type?e.value?e.value.image&&i.uploadedList.push(e.value.image):e.value={name:"",number:"",image:""}:"video"==e.type?i.uploadedList.push(e.value):"file"==e.type&&(e.value?("string"==typeof e.value&&(e.value=e.value.split(",")),i.uploadedList=[].concat((0,o.default)(i.uploadedList),(0,o.default)(e.value.map((function(e){return e.path}))))):e.value=[])})),i.applyField=a,t&&t()}else t&&t(),e.showToast({title:n.msg,icon:"none"})})).catch((function(e){t&&t(),console.error("获取入会信息 ",e)}))},toAgreement:function(){this.$util.toPage({mode:1,path:"/pages/mine/settings/agreement?type=3"})},heandleSubmit:function(){var t=this;e.showLoading({title:"加载中",mask:!0}),this.$refs.memberApply.getApplyField((function(i){var n=[];for(var a in i){if(1==i[a].required){var o=!1;if("checkbox"==i[a].type?i[a].value.length||(o=!0):"image"==i[a].type?2==t.memberType&&"company_logo"==i[a].field||3==t.memberType&&"organize_logo"==i[a].field?i[a].value||(o=!0):i[a].value.length||(o=!0):"cert"==i[a].type?i[a].value.name&&i[a].value.number&&i[a].value.image||(o=!0):"file"==i[a].type?i[a].value.length||(o=!0):i[a].value||(o=!0),o)return e.hideLoading(),void e.showToast({icon:"none",title:i[a].label+"不能为空"})}if("cert"==i[a].type&&(i[a].value.name||i[a].value.number||i[a].value.image)&&(!i[a].value.name||!i[a].value.number||!i[a].value.image))return e.hideLoading(),void e.showToast({icon:"none",title:i[a].label+"存在未填项"});if("number"==i[a].type)i[a].value=Number(i[a].value);else if("checkbox"==i[a].type)i[a].value=i[a].value.join();else if("image"==i[a].type)if(2==t.memberType&&"company_logo"==i[a].field||3==t.memberType&&"organize_logo"==i[a].field)t.uploadedList.includes(i[a].value)||n.push({index:a,value:i[a].value});else for(var l in i[a].value)t.uploadedList.includes(i[a].value[l])||n.push({index:a,number:l,value:i[a].value[l]});else if("video"==i[a].type&&i[a].value)t.uploadedList.includes(i[a].value)||n.push({index:a,value:i[a].value});else if("cert"==i[a].type&&i[a].value.image)t.uploadedList.includes(i[a].value.image)||n.push({index:a,value:i[a].value.image});else if("file"==i[a].type)for(var u in i[a].value)t.uploadedList.includes(i[a].value[u].path)||n.push({index:a,number:u,value:i[a].value[u].path})}e.hideLoading(),t.subscribeMessage((function(){e.showLoading({title:"加载中",mask:!0}),n.length?t.uploadFiles(n,(function(e){for(var a in n)"image"==i[n[a].index].type?2==t.memberType&&"company_logo"==i[n[a].index].field||3==t.memberType&&"organize_logo"==i[n[a].index].field?i[n[a].index].value=e[a]:i[n[a].index].value[n[a].number]=e[a]:"video"==i[n[a].index].type?i[n[a].index].value=e[a]:"cert"==i[n[a].index].type?i[n[a].index].value.image=e[a]:"file"==i[n[a].index].type&&(i[n[a].index].value[n[a].number].path=e[a]);t.submitEvent(i)})):t.submitEvent(i)}))}))},uploadFiles:function(e,t){this.$util.uploadFileMultiple(e.map((function(e){return e.value}))).then((function(e){t(e)})).catch((function(e){console.error("上传文件 ",e)}))},submitEvent:function(t){for(var i in t)"image"==t[i].type&&"object"==(0,a.default)(t[i].value)&&(t[i].value=t[i].value.join());var n={person:getApp().globalData.applyField};2==this.memberType?n.company=t:n.organize=t,this.$util.request("member.apply",{type:this.memberType,data:JSON.stringify(n)}).then((function(t){1==t.code?(getApp().globalData.applyField=[],e.redirectTo({url:"/pages/member/apply/success",success:function(){e.hideLoading()}})):e.showToast({title:t.msg,icon:"none"})})).catch((function(e){console.error("提交入会申请 ",e)}))},subscribeMessage:function(t){var i=this;e.requestSubscribeMessage({tmplIds:[this.subscribeIds.applet_initiation_audit,this.subscribeIds.applet_initiation_success,this.subscribeIds.applet_member_expiretime],success:function(){t()},fail:function(n){20004==n.errCode?e.showModal({title:"提示",content:"请前往设置打开接受通知",confirmColor:i.themeColor,confirmText:"继续提交",success:function(e){e.confirm&&t()}}):e.showModal({title:"提示",content:"未订阅消息，无法接收到会员通知",confirmColor:i.themeColor,confirmText:"继续提交",success:function(e){e.confirm&&t()}})}})}}};t.default=c}).call(this,i("df3c")["default"])},f83b:function(e,t,i){"use strict";var n=i("897e"),a=i.n(n);a.a}},[["d06b","common/runtime","common/vendor"]]]);