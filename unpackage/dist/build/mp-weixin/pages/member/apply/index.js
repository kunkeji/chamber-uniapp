(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/member/apply/index"],{"011b":function(e,t,i){"use strict";(function(e){var n=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(i("3b2d")),o=n(i("af34")),u=n(i("7ca3")),l=n(i("db5e")),r=i("8f59");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}var c={components:{memberApply:function(){Promise.all([i.e("common/vendor"),i.e("pages/component/member/apply")]).then(function(){return resolve(i("3c69"))}.bind(null,i)).catch(i.oe)},selectPicker:function(){i.e("pages/component/picker/select").then(function(){return resolve(i("b3fd"))}.bind(null,i)).catch(i.oe)}},data:function(){return{pageShow:!1,loadEnd:!1,titleBarHeight:0,typeList:[],memberType:1,applyField:[],memberState:{},isRead:!1,reapplyType:null,uploadedList:[]}},computed:function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){(0,u.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},(0,r.mapState)({themeColor:function(e){return e.app.themeColor},iconSheet:function(e){return l.default.svgToUrl("sheet",e.app.themeColor)},subscribeIds:function(e){return e.app.subscribeNotifyIds}})),mounted:function(){var t=e.getSystemInfoSync().statusBarHeight,i=e.getMenuButtonBoundingClientRect();this.titleBarHeight=t+2*(i.top-t)+i.height},onLoad:function(){var t=this;e.showLoading({title:"加载中"}),this.getMemberType(),this.getMemberState((function(){t.loadEnd=!0,e.hideLoading()}))},methods:{pageChange:function(e){this.pageShow=e},getMemberType:function(){var t=this;this.$util.request("member.type").then((function(i){if(1==i.code){var n=i.data;for(var a in t.typeList=[],n)"normal"==n[a].status&&(1==n[a].type?t.typeList.push({id:1,name:"个人会员"}):2==n[a].type?t.typeList.push({id:2,name:"企业会员"}):3==n[a].type&&t.typeList.push({id:3,name:"团体会员"}))}else e.showToast({title:i.msg,icon:"none"})})).catch((function(e){console.error("获取入会类型 ",e)}))},getMemberState:function(t){var i=this;this.$util.request("member.state").then((function(n){1==n.code?(i.memberState=n.data.state,-1==i.memberState.state?i.getField(t):2==i.memberState.state?i.getMemberInfo(t):(e.hideLoading(),e.showModal({title:"系统提示",content:"您已提交入会申请，无需重复提交",cancelText:"返回",confirmText:"前往查看",success:function(t){t.confirm?e.switchTab({url:"/pages/mine/index"}):1==getCurrentPages().length?e.switchTab({url:"/pages/index/index"}):e.navigateBack()}}))):e.showToast({title:n.msg,icon:"none"})})).catch((function(e){console.error("获取会员状态 ",e)}))},getField:function(t){var i=this;this.$util.request("member.field",{type:this.memberType}).then((function(n){if(t&&t(),1==n.code){var a=[];a=1==i.memberType?n.data:n.data.person,a.forEach((function(e){"checkbox"==e.type?e.value=[]:"text"==e.type&&"address"==e.field?e.value={latitude:"",longitude:"",name:"",address:""}:"image"==e.type?"avatar"==e.field?e.value="":e.value=[]:"cert"==e.type?e.value={name:"",number:"",image:""}:"file"==e.type?e.value=[]:e.value=""})),i.applyField=a}else e.showToast({title:n.msg,icon:"none"})})).catch((function(e){console.error("获取入会字段 ",e)}))},getMemberInfo:function(t){var i=this;this.$util.request("member.applyDetails").then((function(n){if(1==n.code){var a=[];n.data.company?(i.memberType=2,i.reapplyType=2,a=n.data.person):n.data.organize?(i.memberType=3,i.reapplyType=3,a=n.data.person):(i.memberType=1,i.reapplyType=1,a=n.data),i.uploadedList=[],a.forEach((function(e){"checkbox"==e.type?e.value?e.value=e.value.split(","):e.value=[]:"text"==e.type&&"address"==e.field?e.value||(e.value={latitude:"",longitude:"",name:"",address:""}):"image"==e.type?"avatar"==e.field?e.value?i.uploadedList.push(e.value):e.value="":e.value?("string"==typeof e.value&&(e.value=e.value.split(",")),i.uploadedList=[].concat((0,o.default)(i.uploadedList),(0,o.default)(e.value))):e.value=[]:"cert"==e.type?e.value?e.value.image&&i.uploadedList.push(e.value.image):e.value={name:"",number:"",image:""}:"video"==e.type?i.uploadedList.push(e.value):"file"==e.type&&(e.value?("string"==typeof e.value&&(e.value=e.value.split(",")),i.uploadedList=[].concat((0,o.default)(i.uploadedList),(0,o.default)(e.value.map((function(e){return e.path}))))):e.value=[])})),i.applyField=a,t&&t()}else t&&t(),e.showToast({title:n.msg,icon:"none"})})).catch((function(e){t&&t(),console.error("获取入会信息 ",e)}))},toAgreement:function(){this.$util.toPage({mode:1,path:"/pages/mine/settings/agreement?type=3"})},selectMemberType:function(){this.$refs.selectPicker.open(this.typeList,this.memberType)},changeMemberType:function(t){this.memberType=t.id,e.showLoading({title:"加载中"}),2==this.memberState.state&&this.reapplyType==this.memberType?this.getMemberInfo((function(){e.hideLoading()})):this.getField((function(){e.hideLoading()}))},heandleSubmit:function(){var t=this;this.isRead?(e.showLoading({title:"加载中",mask:!0}),this.$refs.memberApply.getApplyField((function(i){var n=[];for(var a in i){if(1==i[a].required){var o=!1;if("text"==i[a].type&&"address"==i[a].field?i[a].value.address||(o=!0):"checkbox"==i[a].type?i[a].value.length||(o=!0):"image"==i[a].type?"avatar"==i[a].field?i[a].value||(o=!0):i[a].value.length||(o=!0):"cert"==i[a].type?i[a].value.name&&i[a].value.number&&i[a].value.image||(o=!0):"file"==i[a].type?i[a].value.length||(o=!0):i[a].value||(o=!0),o)return e.hideLoading(),void e.showToast({icon:"none",title:i[a].label+"不能为空"})}if("number"==i[a].type&&"mobile"==i[a].field&&!t.$util.validation("phone",i[a].value))return e.hideLoading(),void e.showToast({icon:"none",title:"请输入正确的手机号"});if("cert"==i[a].type&&(i[a].value.name||i[a].value.number||i[a].value.image)&&(!i[a].value.name||!i[a].value.number||!i[a].value.image))return e.hideLoading(),void e.showToast({icon:"none",title:i[a].label+"存在未填项"});if("number"==i[a].type)i[a].value=Number(i[a].value);else if("checkbox"==i[a].type)i[a].value=i[a].value.join();else if("image"==i[a].type)if("avatar"==i[a].field)t.uploadedList.includes(i[a].value)||n.push({index:a,value:i[a].value});else for(var u in i[a].value)t.uploadedList.includes(i[a].value[u])||n.push({index:a,number:u,value:i[a].value[u]});else if("cert"==i[a].type&&i[a].value.image)t.uploadedList.includes(i[a].value.image)||n.push({index:a,value:i[a].value.image});else if("video"==i[a].type&&i[a].value)t.uploadedList.includes(i[a].value)||n.push({index:a,value:i[a].value});else if("file"==i[a].type)for(var l in i[a].value)t.uploadedList.includes(i[a].value[l].path)||n.push({index:a,number:l,value:i[a].value[l].path})}e.hideLoading(),t.subscribeMessage((function(){e.showLoading({title:"加载中",mask:!0}),t.checkPhone(i,(function(a){a?n.length?t.uploadFiles(n,(function(e){for(var a in n)"image"==i[n[a].index].type?"avatar"==i[n[a].index].field?i[n[a].index].value=e[a]:i[n[a].index].value[n[a].number]=e[a]:"video"==i[n[a].index].type?i[n[a].index].value=e[a]:"cert"==i[n[a].index].type?i[n[a].index].value.image=e[a]:"file"==i[n[a].index].type&&(i[n[a].index].value[n[a].number].path=e[a]);t.submitEvent(i)})):t.submitEvent(i):e.showToast({title:"该手机号已被使用，请更换手机号",icon:"none"})}))}))}))):e.showToast({icon:"none",title:"请仔细阅读并同意《入会协议》"})},uploadFiles:function(e,t){this.$util.uploadFileMultiple(e.map((function(e){return e.value}))).then((function(e){t(e)})).catch((function(e){console.error("上传文件 ",e)}))},submitEvent:function(t){for(var i in t)"image"==t[i].type&&"object"==(0,a.default)(t[i].value)&&(t[i].value=t[i].value.join());1==this.memberType?this.$util.request("member.apply",{type:this.memberType,data:JSON.stringify(t)}).then((function(t){1==t.code?e.redirectTo({url:"/pages/member/apply/success",success:function(){e.hideLoading()}}):e.showToast({title:t.msg,icon:"none"})})).catch((function(t){e.hideLoading(),console.error("提交入会申请 ",t)})):(e.hideLoading(),getApp().globalData.applyField=t,2==this.memberState.state&&this.reapplyType==this.memberType?this.$util.toPage({mode:1,path:"/pages/member/apply/enterprise?reapply=1&type="+this.memberType}):this.$util.toPage({mode:1,path:"/pages/member/apply/enterprise?type="+this.memberType}))},subscribeMessage:function(t){var i=this;1==this.memberType?e.requestSubscribeMessage({tmplIds:[this.subscribeIds.applet_initiation_audit,this.subscribeIds.applet_initiation_success,this.subscribeIds.applet_member_expiretime],success:function(){t()},fail:function(n){20004==n.errCode?e.showModal({title:"提示",content:"请前往设置打开接受通知",confirmColor:i.themeColor,confirmText:"继续提交",success:function(e){e.confirm&&t()}}):e.showModal({title:"提示",content:"未订阅消息，无法接收到会员通知",confirmColor:i.themeColor,confirmText:"继续提交",success:function(e){e.confirm&&t()}})}}):t()},checkPhone:function(t,i){if(1!=this.memberType){var n=t.findIndex((function(e){if("mobile"==e.field)return!0}));this.$util.request("member.applyCheck",{mobile:t[n].value}).then((function(t){1==t.code?1==t.data.use_status?i(!1):i(!0):e.showToast({title:t.msg,icon:"none"})})).catch((function(e){console.error("验证手机号是否重复 ",e)}))}else i(!0)}}};t.default=c}).call(this,i("df3c")["default"])},"2cdc":function(e,t,i){"use strict";i.r(t);var n=i("011b"),a=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"4c91":function(e,t,i){},6743:function(e,t,i){"use strict";i.r(t);var n=i("8d5e"),a=i("2cdc");for(var o in a)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("f78c");var u=i("828b"),l=Object(u["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=l.exports},"7c52":function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("13b0");n(i("3240"));var a=n(i("6743"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"8d5e":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.isRead=!e.isRead})},a=[]},f78c:function(e,t,i){"use strict";var n=i("4c91"),a=i.n(n);a.a}},[["7c52","common/runtime","common/vendor"]]]);