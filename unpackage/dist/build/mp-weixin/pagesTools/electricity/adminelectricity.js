(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesTools/electricity/adminelectricity"],{"269f":function(t,n,e){"use strict";e.r(n);var i=e("df99"),a=e.n(i);for(var c in i)["default"].indexOf(c)<0&&function(t){e.d(n,t,(function(){return i[t]}))}(c);n["default"]=a.a},"418a":function(t,n,e){"use strict";var i=e("eb43"),a=e.n(i);a.a},a758:function(t,n,e){"use strict";(function(t,n){var i=e("47a9");e("13b0");i(e("3240"));var a=i(e("b822"));t.__webpack_require_UNI_MP_PLUGIN__=e,n(a.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])},b822:function(t,n,e){"use strict";e.r(n);var i=e("e65a"),a=e("269f");for(var c in a)["default"].indexOf(c)<0&&function(t){e.d(n,t,(function(){return a[t]}))}(c);e("418a");var o=e("828b"),u=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);n["default"]=u.exports},df99:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e={data:function(){return{electricity:"",amount:"",meterInfo:null,submitting:!1,querying:!1}},methods:{scanCode:function(){var n=this;t.scanCode({success:function(t){n.electricity=t.result,n.checkLength()},fail:function(t){console.error("Scan failed:",t)}})},checkLength:function(){12===this.electricity.length&&this.queryBalance()},queryBalance:function(){var n=this,e=this;e.querying=!0,t.showLoading({title:"正在查询...",mask:!0}),e.$util.request("mall.balance",{electricity:this.electricity}).then((function(e){1===e.code?(e.data.balance=(e.data.balance/100).toFixed(2),n.meterInfo=e.data):t.showToast({title:e.msg,icon:"none"})})).catch((function(n){console.error("Error querying balance:",n),t.showToast({title:"查询失败，请重试",icon:"none"})})).finally((function(){e.querying=!1,t.hideLoading()}))},handleOperation:function(n){var e=this;if(this.meterInfo){var i={charge:{title:"充值",amount:!0,api:"mall.direct_charge"},deduct:{title:"扣款",amount:!0,api:"mall.deduct"},close:{title:"拉闸",api:"mall.close"},open:{title:"合闸",api:"mall.open"},clear:{title:"清零",api:"mall.clear"}}[n];if(!i.amount||this.amount){var a="确认要对电表".concat(this.electricity,"进行").concat(i.title,"操作吗？\n");i.amount&&(a+="金额：".concat(this.amount,"元\n")),a+="用户：".concat(this.meterInfo.room_person,"\n位置：").concat(this.meterInfo.meter_place),t.showModal({title:"操作确认",content:a,success:function(t){t.confirm&&!e.submitting&&e.submitOperation(i.api,n)}})}else t.showToast({title:"请输入金额",icon:"none"})}else t.showToast({title:"请先查询电表信息",icon:"none"})},submitOperation:function(n,e){var i=this;i.submitting=!0,t.showLoading({title:"处理中...",mask:!0});var a={electricity:i.electricity};["charge","deduct"].includes(e)&&(a.amount=i.amount),i.$util.request(n,a).then((function(n){t.showToast({icon:"none",title:n.msg}),1===n.code&&setTimeout((function(){i.amount="",i.queryBalance()}),1500)})).finally((function(){i.submitting=!1,t.hideLoading()}))}}};n.default=e}).call(this,e("df3c")["default"])},e65a:function(t,n,e){"use strict";e.d(n,"b",(function(){return i})),e.d(n,"c",(function(){return a})),e.d(n,"a",(function(){}));var i=function(){var t=this,n=t.$createElement;t._self._c;t._isMounted||(t.e0=function(n){!t.submitting&&t.handleOperation("charge")},t.e1=function(n){!t.submitting&&t.handleOperation("deduct")},t.e2=function(n){!t.submitting&&t.handleOperation("close")},t.e3=function(n){!t.submitting&&t.handleOperation("open")},t.e4=function(n){!t.submitting&&t.handleOperation("clear")})},a=[]},eb43:function(t,n,e){}},[["a758","common/runtime","common/vendor"]]]);